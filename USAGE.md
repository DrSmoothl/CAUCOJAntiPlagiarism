# 比赛代码查重插件使用示例

本文档展示如何使用比赛代码查重插件进行代码相似度检测。

## 快速开始

### 1. 访问查重系统
打开浏览器，访问：`http://your-hydro-domain/plagiarism`

你将看到查重系统的主界面，显示：
- 系统统计信息（总报告数、已完成数、处理中数）
- 最近的查重报告列表
- 快速操作按钮

### 2. 创建新的查重任务

#### 方法一：从主界面创建
1. 点击主界面的"新建查重任务"按钮
2. 跳转到比赛查重列表页面

#### 方法二：直接访问比赛列表
1. 访问：`/plagiarism/contest`
2. 在"选择比赛"下拉框中选择目标比赛
3. 点击"新建查重任务"按钮

### 3. 选择查重题目
1. 系统跳转到题目选择页面
2. 显示该比赛的所有题目列表
3. 选择需要查重的题目：
   - 单选：勾选特定题目
   - 多选：勾选多个题目
   - 全选：点击"全选"按钮
4. 点击"开始查重"按钮

### 4. 等待处理完成
1. 系统创建查重任务并开始后台处理
2. 跳转到比赛查重总览页面
3. 可以看到任务状态：
   - **等待中**：任务已创建，等待处理
   - **处理中**：正在进行代码相似度分析
   - **已完成**：查重完成，可查看结果
   - **失败**：处理出错，需要重新创建

### 5. 查看查重结果

#### 比赛总览
在比赛查重总览页面，你可以看到：
- 所有查重报告的列表
- 每个报告包含的题目数量
- 处理状态和创建时间
- 查重结果概览（如有相似代码）

#### 具体题目结果
点击某个题目的"查看详细结果"链接，进入题目查重详情页面：

1. **按语言分组显示**：
   - C语言组
   - C++语言组  
   - Python语言组
   - Java语言组

2. **相似提交对**：
   - 显示用户名和用户ID
   - 相似度百分比（圆环图显示）
   - 相似代码片段数量

3. **代码片段对比**：
   - 点击"查看相似代码片段"按钮
   - 显示具体的相似代码位置
   - 并排对比两个用户的代码
   - 高亮显示相似度和行号范围

## 实际使用场景

### 场景1：期末考试查重
```
比赛：2024年春季期末考试
题目：选择所有编程题（5道）
处理：等待15分钟处理完成
结果：发现3组高相似度代码，需要人工审核
```

### 场景2：程序设计竞赛
```
比赛：ACM校内选拔赛
题目：只选择算法题（排除签到题）
处理：等待8分钟处理完成
结果：未发现明显作弊行为
```

### 场景3：作业提交检查
```
比赛：数据结构课程作业
题目：选择特定章节的题目
处理：等待5分钟处理完成
结果：发现部分学生代码高度相似，需要进一步调查
```

## 结果解读指南

### 相似度判断标准
- **90%以上**：几乎完全相同，强烈怀疑抄袭
- **80-90%**：高度相似，需要重点关注
- **60-80%**：中等相似，建议人工审核
- **40-60%**：部分相似，可能是算法思路相同
- **40%以下**：相似度较低，通常为正常现象

### 注意事项
1. **算法题特点**：某些经典算法的实现方式相对固定，相似度较高属于正常现象
2. **语言特性**：不同编程语言的语法差异可能影响相似度计算
3. **代码风格**：相同的逻辑用不同编码风格实现，相似度会有差异
4. **题目难度**：简单题目的解法相对固定，复杂题目的解法更多样化

### 人工审核建议
遇到高相似度代码时，建议进行以下检查：
1. 查看提交时间差异
2. 对比变量命名和注释风格  
3. 检查代码结构和算法实现
4. 询问学生解题思路
5. 结合其他题目的表现进行综合判断

## 系统维护

### 清理历史数据
```javascript
// 删除30天前的查重报告
db.plagiarism_reports.deleteMany({
    createdAt: { $lt: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000) }
});
```

### 性能优化
1. 定期清理过期的查重报告
2. 对于大型比赛，建议分批次查重
3. 调整相似度阈值以减少误报

### 故障排查
1. 检查MongoDB连接状态
2. 查看HydroOJ系统日志
3. 确认用户权限配置
4. 验证比赛和题目数据完整性

## 高级用法

### 自定义相似度阈值
修改 `index.ts` 中的相关参数：
```typescript
// 修改这个值来调整相似度判断标准
if (similarity > 0.6) { // 默认0.6，可调整为0.5或0.7
```

### 调整代码分析窗口
```typescript
// 修改代码片段分析的窗口大小
const windowSize = 5; // 默认5行，可调整为3-10行
```

### 语言分组自定义
```typescript
// 添加新的语言支持或调整现有分组规则
if (submission.lang.includes('go')) {
    langGroup = 'golang';
}
```

## 技术支持

如果在使用过程中遇到问题：
1. 查看浏览器控制台错误信息
2. 检查HydroOJ后端日志
3. 确认数据库连接和数据完整性
4. 联系系统管理员或开发团队

---

**提示**：查重结果仅供参考，最终的学术诚信判断需要结合多方面因素进行人工审核。
