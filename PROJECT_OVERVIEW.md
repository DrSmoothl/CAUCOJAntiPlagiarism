# æ¯”èµ›ä»£ç æŸ¥é‡æ’ä»¶ - é¡¹ç›®æ€»è§ˆ

## ğŸ“ é¡¹ç›®ç»“æ„

```
plagiarism-plugin/
â”œâ”€â”€ index.ts                          # æ ¸å¿ƒåç«¯é€»è¾‘
â”œâ”€â”€ package.json                      # é¡¹ç›®é…ç½®å’Œä¾èµ–
â”œâ”€â”€ README.md                         # é¡¹ç›®è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ USAGE.md                          # ä½¿ç”¨æŒ‡å—
â”œâ”€â”€ config.env                        # é…ç½®å‚æ•°
â”œâ”€â”€ install.sh                        # Linux/Macå®‰è£…è„šæœ¬
â”œâ”€â”€ install.bat                       # Windowså®‰è£…è„šæœ¬
â””â”€â”€ templates/                        # å‰ç«¯æ¨¡æ¿æ–‡ä»¶
    â”œâ”€â”€ plagiarism_main.html          # ä¸»ç•Œé¢
    â”œâ”€â”€ plagiarism_contest_list.html  # æ¯”èµ›åˆ—è¡¨
    â”œâ”€â”€ plagiarism_contest_select.html # é¢˜ç›®é€‰æ‹©
    â”œâ”€â”€ plagiarism_contest_detail.html # æ¯”èµ›è¯¦æƒ…
    â””â”€â”€ plagiarism_problem_detail.html # é¢˜ç›®è¯¦æƒ…
```

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½

### 1. æŸ¥é‡æµç¨‹ç®¡ç†
- **æ¯”èµ›é€‰æ‹©**ï¼šä»HydroOJä¸­çš„æ‰€æœ‰æ¯”èµ›ä¸­é€‰æ‹©ç›®æ ‡æ¯”èµ›
- **é¢˜ç›®ç­›é€‰**ï¼šçµæ´»é€‰æ‹©æ¯”èµ›ä¸­çš„ç‰¹å®šé¢˜ç›®è¿›è¡ŒæŸ¥é‡
- **å¼‚æ­¥å¤„ç†**ï¼šåå°å¼‚æ­¥å¤„ç†æŸ¥é‡ä»»åŠ¡ï¼Œä¸é˜»å¡ç”¨æˆ·ç•Œé¢
- **çŠ¶æ€è·Ÿè¸ª**ï¼šå®æ—¶è·Ÿè¸ªæŸ¥é‡ä»»åŠ¡çš„å¤„ç†çŠ¶æ€

### 2. æ™ºèƒ½ä»£ç åˆ†æ
- **å¤šè¯­è¨€æ”¯æŒ**ï¼šæ”¯æŒCã€C++ã€Pythonã€Javaç­‰ä¸»æµç¼–ç¨‹è¯­è¨€
- **ä»£ç æ ‡å‡†åŒ–**ï¼šè‡ªåŠ¨ç§»é™¤æ³¨é‡Šã€æ ¼å¼åŒ–ä»£ç ä»¥æé«˜å‡†ç¡®æ€§
- **ç›¸ä¼¼åº¦ç®—æ³•**ï¼šåŸºäºLevenshteinç¼–è¾‘è·ç¦»çš„ç›¸ä¼¼åº¦è®¡ç®—
- **ç‰‡æ®µè¯†åˆ«**ï¼šç²¾ç¡®å®šä½ç›¸ä¼¼çš„ä»£ç ç‰‡æ®µå¹¶æ ‡è®°è¡Œå·

### 3. å¯è§†åŒ–ç»“æœå±•ç¤º
- **åˆ†å±‚å±•ç¤º**ï¼šæ¯”èµ› â†’ é¢˜ç›® â†’ è¯­è¨€ â†’ ç›¸ä¼¼å¯¹çš„å±‚çº§ç»“æ„
- **è¿›åº¦å¯è§†åŒ–**ï¼šåœ†ç¯å›¾ã€è¿›åº¦æ¡ç­‰ç›´è§‚æ˜¾ç¤ºç›¸ä¼¼åº¦
- **ä»£ç å¯¹æ¯”**ï¼šå¹¶æ’æ˜¾ç¤ºç›¸ä¼¼ä»£ç ç‰‡æ®µï¼Œä¾¿äºäººå·¥å®¡æ ¸
- **é«˜äº®æ ‡è®°**ï¼šçªå‡ºæ˜¾ç¤ºé«˜ç›¸ä¼¼åº¦ç»“æœ

## ğŸ’¾ æ•°æ®æ¨¡å‹

### æŸ¥é‡æŠ¥å‘Š (plagiarism_reports)
```typescript
{
  _id: ObjectId,
  contestId: ObjectId,        // æ¯”èµ›ID
  problemIds: number[],       // é¢˜ç›®IDæ•°ç»„
  createdAt: Date,           // åˆ›å»ºæ—¶é—´
  createdBy: number,         // åˆ›å»ºè€…ç”¨æˆ·ID
  status: string,            // pending/processing/completed/failed
  results: PlagiarismResult[] // æŸ¥é‡ç»“æœæ•°ç»„
}
```

### ç›¸ä¼¼åº¦ç»“æœ
```typescript
{
  problemId: number,         // é¢˜ç›®ID
  language: string,          // ç¼–ç¨‹è¯­è¨€
  pairs: [{                  // ç›¸ä¼¼æäº¤å¯¹
    submission1: ObjectId,   // æäº¤1 ID
    submission2: ObjectId,   // æäº¤2 ID  
    user1: number,          // ç”¨æˆ·1 ID
    user2: number,          // ç”¨æˆ·2 ID
    similarity: number,     // ç›¸ä¼¼åº¦(0-1)
    details: [{             // ç›¸ä¼¼ç‰‡æ®µè¯¦æƒ…
      startLine1: number,   // ä»£ç 1å¼€å§‹è¡Œ
      endLine1: number,     // ä»£ç 1ç»“æŸè¡Œ
      startLine2: number,   // ä»£ç 2å¼€å§‹è¡Œ
      endLine2: number,     // ä»£ç 2ç»“æŸè¡Œ
      text1: string,        // ä»£ç 1æ–‡æœ¬
      text2: string,        // ä»£ç 2æ–‡æœ¬
      similarity: number    // ç‰‡æ®µç›¸ä¼¼åº¦
    }]
  }]
}
```

## ğŸ”§ æŠ€æœ¯æ¶æ„

### åç«¯æ¶æ„
- **Handleræ¨¡å¼**ï¼šéµå¾ªHydroOJçš„Handleræ¶æ„æ¨¡å¼
- **MongoDBé›†æˆ**ï¼šåŸç”ŸMongoDBæ“ä½œï¼Œæ— éœ€é¢å¤–ORM
- **å¼‚æ­¥å¤„ç†**ï¼šä½¿ç”¨Promise/async-awaitå¤„ç†è€—æ—¶æ“ä½œ
- **ç±»å‹å®‰å…¨**ï¼šå®Œæ•´çš„TypeScriptç±»å‹å®šä¹‰

### å‰ç«¯æ¶æ„
- **æ¨¡æ¿å¼•æ“**ï¼šNunjucksæ¨¡æ¿ï¼Œä¸HydroOJä¿æŒä¸€è‡´
- **å“åº”å¼è®¾è®¡**ï¼šæ”¯æŒæ¡Œé¢ç«¯å’Œç§»åŠ¨ç«¯è®¿é—®
- **ç»„ä»¶åŒ–CSS**ï¼šç‹¬ç«‹çš„CSSå‘½åç©ºé—´ï¼Œé¿å…æ ·å¼å†²çª
- **äº¤äº’å¢å¼º**ï¼šJavaScriptå¢å¼ºç”¨æˆ·äº¤äº’ä½“éªŒ

### ç®—æ³•å®ç°
```typescript
// ç›¸ä¼¼åº¦è®¡ç®—æ ¸å¿ƒç®—æ³•
static calculateSimilarity(code1: string, code2: string, lang: string): number {
    const normalized1 = this.normalizeCode(code1, lang);
    const normalized2 = this.normalizeCode(code2, lang);
    
    const distance = this.levenshteinDistance(normalized1, normalized2);
    const maxLength = Math.max(normalized1.length, normalized2.length);
    
    return 1 - (distance / maxLength);
}
```

## ğŸ›£ï¸ è·¯ç”±è®¾è®¡

| è·¯ç”± | åŠŸèƒ½ | æ¨¡æ¿ |
|------|------|------|
| `/plagiarism` | ç³»ç»Ÿä¸»ç•Œé¢ | `plagiarism_main.html` |
| `/plagiarism/contest` | æ¯”èµ›åˆ—è¡¨ | `plagiarism_contest_list.html` |
| `/plagiarism/contest/:id/select` | é¢˜ç›®é€‰æ‹© | `plagiarism_contest_select.html` |
| `/plagiarism/contest/:id` | æ¯”èµ›è¯¦æƒ… | `plagiarism_contest_detail.html` |
| `/plagiarism/contest/:id/:pid` | é¢˜ç›®è¯¦æƒ… | `plagiarism_problem_detail.html` |

## ğŸ¨ ç•Œé¢è®¾è®¡

### è®¾è®¡åŸåˆ™
- **ä¸€è‡´æ€§**ï¼šä¸HydroOJä¸»é¢˜ä¿æŒè§†è§‰ä¸€è‡´
- **æ˜“ç”¨æ€§**ï¼šç›´è§‚çš„æ“ä½œæµç¨‹å’Œæ¸…æ™°çš„ä¿¡æ¯å±‚çº§
- **å¯è®¿é—®æ€§**ï¼šè‰¯å¥½çš„å¯¹æ¯”åº¦å’Œé”®ç›˜å¯¼èˆªæ”¯æŒ
- **å“åº”å¼**ï¼šé€‚é…å„ç§å±å¹•å°ºå¯¸

### CSSå‘½åè§„èŒƒ
```css
.plagiarism-container     /* å®¹å™¨å¸ƒå±€ */
.plagiarism-header        /* é¡µé¢å¤´éƒ¨ */
.plagiarism-btn           /* æŒ‰é’®æ ·å¼ */
.plagiarism-card          /* å¡ç‰‡ç»„ä»¶ */
.plagiarism-alert         /* æç¤ºä¿¡æ¯ */
```

### é¢œè‰²æ–¹æ¡ˆ
- **ä¸»è‰²è°ƒ**ï¼š#3498dbï¼ˆè“è‰²ï¼‰
- **æˆåŠŸè‰²**ï¼š#27ae60ï¼ˆç»¿è‰²ï¼‰
- **è­¦å‘Šè‰²**ï¼š#f39c12ï¼ˆæ©™è‰²ï¼‰
- **å±é™©è‰²**ï¼š#e74c3cï¼ˆçº¢è‰²ï¼‰
- **ä¸­æ€§è‰²**ï¼š#7f8c8dï¼ˆç°è‰²ï¼‰

## ğŸ”’ å®‰å…¨è€ƒè™‘

### æƒé™æ§åˆ¶
- ä»…å…·å¤‡ `PRIV_EDIT_SYSTEM` æƒé™çš„ç”¨æˆ·å¯è®¿é—®
- æ‰€æœ‰æŸ¥é‡åŠŸèƒ½éƒ½éœ€è¦æƒé™éªŒè¯
- ä»£ç å†…å®¹ä»…ç”¨äºåˆ†æï¼Œä¸åšå…¶ä»–ç”¨é€”

### æ•°æ®ä¿æŠ¤
- æŸ¥é‡ç»“æœä»…ä¾›ç®¡ç†å‘˜æŸ¥çœ‹
- æ”¯æŒå®šæœŸæ¸…ç†å†å²æ•°æ®
- æ•æ„Ÿä¿¡æ¯ä¸åœ¨æ—¥å¿—ä¸­è®°å½•

### æ€§èƒ½ä¼˜åŒ–
- å¼‚æ­¥å¤„ç†é¿å…ç•Œé¢é˜»å¡
- æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½
- åˆ†é¡µæ˜¾ç¤ºå‡å°‘å†…å­˜å ç”¨

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### å¤„ç†èƒ½åŠ›
- **å°å‹æ¯”èµ›**ï¼ˆ<50äººï¼‰ï¼šçº¦2-5åˆ†é’Ÿ
- **ä¸­å‹æ¯”èµ›**ï¼ˆ50-200äººï¼‰ï¼šçº¦5-15åˆ†é’Ÿ  
- **å¤§å‹æ¯”èµ›**ï¼ˆ>200äººï¼‰ï¼šçº¦15-30åˆ†é’Ÿ

### å‡†ç¡®æ€§
- **é«˜ç›¸ä¼¼åº¦æ£€æµ‹**ï¼ˆ>80%ï¼‰ï¼šå‡†ç¡®ç‡95%+
- **ä¸­ç­‰ç›¸ä¼¼åº¦æ£€æµ‹**ï¼ˆ60-80%ï¼‰ï¼šå‡†ç¡®ç‡85%+
- **è¯¯æŠ¥ç‡**ï¼š<5%

### èµ„æºå ç”¨
- **å†…å­˜ä½¿ç”¨**ï¼šå³°å€¼çº¦500MBï¼ˆå¤§å‹æ¯”èµ›ï¼‰
- **CPUå ç”¨**ï¼šå¤„ç†æœŸé—´çº¦30-50%
- **å­˜å‚¨ç©ºé—´**ï¼šæ¯ä¸ªæŠ¥å‘Šçº¦1-10MB

## ğŸ”® æœªæ¥è§„åˆ’

### v1.1 è®¡åˆ’åŠŸèƒ½
- [ ] æ”¯æŒæ›´å¤šç¼–ç¨‹è¯­è¨€ï¼ˆGoã€Rustã€Kotlinç­‰ï¼‰
- [ ] ä¼˜åŒ–ç›¸ä¼¼åº¦ç®—æ³•ï¼ˆASTçº§åˆ«åˆ†æï¼‰
- [ ] æ·»åŠ æ‰¹é‡å¯¼å‡ºåŠŸèƒ½
- [ ] é›†æˆé‚®ä»¶é€šçŸ¥

### v2.0 æ„¿æ™¯åŠŸèƒ½
- [ ] æœºå™¨å­¦ä¹ å¢å¼ºçš„ç›¸ä¼¼åº¦æ£€æµ‹
- [ ] å®æ—¶æŸ¥é‡APIæ¥å£
- [ ] å¤šç»´åº¦ä½œå¼Šè¡Œä¸ºåˆ†æ
- [ ] å¯è§†åŒ–ç»Ÿè®¡æŠ¥è¡¨

## ğŸ¤ è´¡çŒ®æŒ‡å—

### å¼€å‘ç¯å¢ƒ
1. Node.js 16+ å’Œ npm/pnpm
2. HydroOJ 5.0.0-beta.5+ å¼€å‘ç¯å¢ƒ
3. MongoDB 4.4+
4. TypeScript å¼€å‘å·¥å…·

### ä»£ç è§„èŒƒ
- ä½¿ç”¨TypeScriptç¼–å†™æ‰€æœ‰åç«¯ä»£ç 
- éµå¾ªESLintå’ŒPrettierè§„èŒƒ
- ç¼–å†™å®Œæ•´çš„ç±»å‹å®šä¹‰
- æ·»åŠ é€‚å½“çš„æ³¨é‡Šå’Œæ–‡æ¡£

### æµ‹è¯•å»ºè®®
- åˆ›å»ºæµ‹è¯•æ¯”èµ›å’Œæµ‹è¯•ç”¨æˆ·
- å‡†å¤‡ä¸åŒç›¸ä¼¼åº¦çš„ä»£ç æ ·æœ¬
- æµ‹è¯•å„ç§è¾¹ç•Œæƒ…å†µ
- éªŒè¯æƒé™æ§åˆ¶åŠŸèƒ½

---

**é¡¹ç›®çŠ¶æ€**ï¼šâœ… åŠŸèƒ½å®Œæ•´ï¼Œå¯æŠ•å…¥ç”Ÿäº§ä½¿ç”¨  
**ç»´æŠ¤çŠ¶æ€**ï¼šğŸ”„ æŒç»­ç»´æŠ¤ä¸­  
**ç¤¾åŒºæ”¯æŒ**ï¼šğŸ’¬ æ¬¢è¿åé¦ˆå’Œè´¡çŒ®
